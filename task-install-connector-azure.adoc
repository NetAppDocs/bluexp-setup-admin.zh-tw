---
sidebar: sidebar 
permalink: task-install-connector-azure.html 
keywords: install connector, azure connector installation, azure connector, install connector in azure, bluexp, azure marketplace, manual install, create connector 
summary: 直接從 BlueXP 網路型主控台、 Azure Marketplace 或在您自己的 Linux 主機上安裝軟體、建立 Connector 。 
---
= 在 Azure 中建立 Connector
:hardbreaks:
:allow-uri-read: 
:nofooter: 
:icons: font
:linkattrs: 
:imagesdir: ./media/


[role="lead"]
直接從 BlueXP 網路型主控台、 Azure Marketplace 或在您自己的 Linux 主機上安裝軟體、建立 Connector 。

[role="tabbed-block"]
====
.藍圖
--
.您需要的產品
* Azure 訂閱。
* 您所選擇的 Azure 區域中的 Vnet 和子網路。
* 若貴組織需要代理處理所有傳出的網際網路流量、請參閱Proxy伺服器的詳細資料：
+
** IP 位址
** 認證資料
** HTTPS憑證


* SSH 公開金鑰、如果您想要將該驗證方法用於 Connector 虛擬機器。驗證方法的另一個選項是使用密碼。
+
https://learn.microsoft.com/en-us/azure/virtual-machines/linux-vm-connect?tabs=Linux["瞭解如何在 Azure 中連線至 Linux VM"^]

* 如果您不想讓BlueXP自動為Connector建立Azure角色、則需要自行建立 link:reference-permissions-azure.html["使用此頁面上的原則"]。
+
這些權限適用於Connector執行個體本身。這是一組不同於您先前設定的權限、只要部署Connector即可。



.步驟
. 如果您要建立第一個工作環境、請按一下 * 新增工作環境 * 、然後依照提示進行。否則、請按一下「 * Connector* 」下拉式清單、然後選取「 * 新增 Connector* 」。
+
image:screenshot_connector_add.gif["螢幕擷取畫面、會在標題和「新增連接器」動作中顯示「連接器」圖示。"]

. 選擇 * Microsoft Azure * 作為雲端供應商。
. 在*部署連接器*頁面上：
+
.. 在 * 驗證 * 下、選取符合您設定 Azure 權限方式的驗證選項：
+
*** 選取 * Azure 使用者帳戶 * 以登入您的 Microsoft 帳戶、該帳戶應具有必要的權限。
+
此表單由 Microsoft 擁有及託管。您的認證資料不會提供給 NetApp 。

+

TIP: 如果您已經登入Azure帳戶、則BlueXP會自動使用該帳戶。如果您有多個帳戶、則可能需要先登出、以確保您使用的是正確的帳戶。

*** 選取 * Active Directory 服務主體 * 以輸入有關授與必要權限的 Azure Active Directory 服務主體的資訊：
+
**** 應用程式（用戶端）ID
**** 目錄（租戶）ID
**** 用戶端機密






+
link:task-set-up-permissions-azure.html["瞭解如何取得服務主體的這些值"]。

. 依照精靈中的步驟建立連接器：
+
** * VM 驗證 * ：選擇 Azure 訂閱、位置、新資源群組或現有資源群組、然後為您正在建立的 Connector 虛擬機器選擇驗證方法。
+
虛擬機器的驗證方法可以是密碼或 SSH 公開金鑰。

+
https://learn.microsoft.com/en-us/azure/virtual-machines/linux-vm-connect?tabs=Linux["瞭解如何在 Azure 中連線至 Linux VM"^]

** *詳細資料*：輸入執行個體的名稱、指定標記、然後選擇是否要BlueXP建立具有所需權限的新角色、或是要選取所設定的現有角色 link:reference-permissions-azure.html["必要的權限"]。
+
請注意、您可以選擇與此角色相關的訂閱。您選擇的每個訂閱都會提供Connector權限、讓他們在Cloud Volumes ONTAP 這些訂閱中部署功能。

** * 網路 * ：選擇 Vnet 和子網路、是否啟用公用 IP 位址、以及是否指定 Proxy 組態（選用）。
** * 安全性群組 * ：選擇是否要建立新的安全性群組、或是選擇允許所需輸入和輸出規則的現有安全性群組。
+
link:reference-ports-azure.html["檢視 Azure 的安全性群組規則"]。

** *審查*：請檢閱您的選擇、確認您的設定正確無誤。


. 按一下「 * 新增 * 」。
+
虛擬機器應在約 7 分鐘內就緒。您應該留在頁面上、直到程序完成為止。



.結果
程序完成後、即可從 BlueXP 使用 Connector 。

--
.Azure Marketplace
--
.步驟
. 前往Azure Marketplace的NetApp Connector VM頁面。
+
https://azuremarketplace.microsoft.com/en-us/marketplace/apps/netapp.netapp-oncommand-cloud-manager["適用於商業區域的Azure Marketplace頁面"^]

. 按一下「 * 立即取得 * 」、然後按一下「 * 繼續 * 」。
. 從 Azure 入口網站按一下 * 「 Create 」（建立） * 、然後依照步驟設定虛擬機器。
+
設定 VM 時請注意下列事項：

+
** 連接器可搭配HDD或SSD磁碟以最佳方式執行。
** 選擇符合 CPU 和 RAM 需求的 VM 大小。我們建議使用 DS3 v2 。
+
link:reference-host-requirements-azure.html["檢閱 VM 需求"]。

** 對於網路安全性群組、 Connector 需要使用 SSH 、 HTTP 和 HTTPS 的傳入連線。特定組態還需要一些規則。
+
link:reference-ports-azure.html["檢視 Azure 的安全性群組規則"]。

** 在 * 管理 * 下、選取 * 開啟 * 、為 Connector VM 啟用 * 系統指派的託管識別 * 。
+
此設定非常重要、因為託管身分識別可讓 Connector 虛擬機器在 Azure Active Directory 中識別自己、而無需提供任何認證。完成後、您需要指派您建立的自訂角色 https://docs.microsoft.com/en-us/azure/active-directory/managed-identities-azure-resources/overview["深入瞭解 Azure 資源的託管身分識別"^]。



. 在「 * 檢閱 + 建立 * 」頁面上、檢閱您的選擇、然後按一下「 * 建立 * 」開始部署。
+
Azure 以指定的設定部署虛擬機器。虛擬機器和 Connector 軟體應在大約五分鐘內執行。

. 從連線至 Connector 虛擬機器的主機開啟網頁瀏覽器、然後輸入下列 URL ：
+
https://_ipaddress_[]

. 登入後、設定 Connector ：
+
.. 指定與 Connector 相關聯的 BlueXP 帳戶。
.. 輸入系統名稱。
.. 在 * 您是在安全的環境中執行？ * 保持停用限制模式。
+
您應該保持停用受限模式、因為這些步驟說明如何在標準模式中使用 BlueXP 。只有當您擁有安全的環境、而且想要中斷此帳戶與 BlueXP 後端服務的連線時、才應啟用受限模式。如果是這樣、 link:task-quick-start-restricted-mode.html["請依照步驟、以受限模式開始使用 BlueXP"]。

.. 按一下 * 開始 * 。




Connector 現已安裝、並已使用您的 BlueXP 帳戶進行設定。

.接下來呢？
link:task-provide-permissions-azure.html["提供 BlueXP 先前設定的權限"]。

--
.手動安裝
--
.您需要的產品
* 安裝Connector的root權限。
* Proxy伺服器的詳細資料、如果需要Proxy才能從Connector存取網際網路。
+
您可以選擇在安裝後設定Proxy伺服器、但需要重新啟動Connector。

* CA 簽署的憑證（如果 Proxy 伺服器使用 HTTPS 或 Proxy 是攔截 Proxy ）。
* Azure 中 VM 上啟用的託管身分識別、可讓您透過自訂角色提供所需的 Azure 權限。
+
https://learn.microsoft.com/en-us/azure/active-directory/managed-identities-azure-resources/qs-configure-portal-windows-vm["Microsoft Azure 文件：使用 Azure 入口網站、在 VM 上設定 Azure 資源的託管身分識別"^]



.關於這項工作
* 安裝會安裝 AWS 命令列工具（ awscli ）、以啟用 NetApp 支援的還原程序。
+
如果您收到安裝 awscli 失敗的訊息、您可以放心忽略該訊息。無需使用工具、連接器即可順利運作。

* NetApp 支援網站上提供的安裝程式可能是較早的版本。安裝後、如果有新版本可用、 Connector 會自動自行更新。


.步驟
. 確認已啟用並執行Docker。
+
[source, cli]
----
sudo systemctl enable docker && sudo systemctl start docker
----
. 如果主機上已設定_http或_https或proxy_系統變數、請將其移除：
+
[source, cli]
----
unset http_proxy
unset https_proxy
----
+
如果您未移除這些系統變數、安裝將會失敗。

. 從下載Connector軟體 https://mysupport.netapp.com/site/products/all/details/cloud-manager/downloads-tab["NetApp 支援網站"^]，然後將其複製到 Linux 主機。
+
您應該下載「線上」 Connector 安裝程式、以供您的網路或雲端使用。Connector 有獨立的「離線」安裝程式、但僅支援私有模式部署。

. 指派執行指令碼的權限。
+
[source, cli]
----
chmod +x OnCommandCloudManager-<version>
----
+
其中、就是您下載的Connector版本<version> 。

. 執行安裝指令碼。
+
[source, cli]
----
 ./OnCommandCloudManager-<version> --proxy <HTTP or HTTPS proxy server> --cacert <path and file name of a CA-signed certificate>
----
+
-Proxy和--cacert參數是可選的。如果您有Proxy伺服器、則必須輸入所示的參數。安裝程式不會提示您提供Proxy的相關資訊。

+
以下是使用兩個選用參數的命令範例：

+
[source, cli]
----
 ./OnCommandCloudManager-V3.9.26 --proxy https://user:password@10.0.0.30:8080/ --cacert /tmp/cacert/certificate.cer
----
+
-Proxy會使用下列其中一種格式、將Connector設定為使用HTTP或HTTPS Proxy伺服器：

+
** \http://address:port
** \http://username:password@address:port
** \https://address:port
** \https://username:password@address:port


+
-cacert指定用於連接器與Proxy伺服器之間HTTPS存取的CA簽署憑證。只有當您指定 HTTPS Proxy 伺服器或 Proxy 是攔截 Proxy 時、才需要此參數。

. 等待安裝完成。
+
安裝結束時、如果您指定Proxy伺服器、Connector服務（occm）會重新啟動兩次。

. 從連線至 Connector 虛擬機器的主機開啟網頁瀏覽器、然後輸入下列 URL ：
+
https://_ipaddress_[]

. 登入後、設定 Connector ：
+
.. 指定與 Connector 相關聯的 BlueXP 帳戶。
.. 輸入系統名稱。
.. 在 * 您是在安全的環境中執行？ * 保持停用限制模式。
+
您應該保持停用受限模式、因為這些步驟說明如何在標準模式中使用 BlueXP 。只有當您擁有安全的環境、而且想要中斷此帳戶與 BlueXP 後端服務的連線時、才應啟用受限模式。如果是這樣、 link:task-quick-start-restricted-mode.html["請依照步驟、以受限模式開始使用 BlueXP"]。

.. 按一下 * 開始 * 。




.結果
Connector 現已安裝、並已使用您的 BlueXP 帳戶進行設定。

.接下來呢？
link:task-provide-permissions-azure.html["提供 BlueXP 先前設定的權限"]。

--
====