---
sidebar: sidebar 
permalink: task-launching-azure-mktp.html 
keywords: install, installation, installing, marketplace, azure, deploy, virtual machine, permissions, deploy connector in azure, install connector in azure 
summary: 對於Azure商用區域而言、最好直接從BlueXP建立Connector、但您也可以從Azure Marketplace（如果您願意）啟動Connector。對於Azure政府區域而言、您無法從BlueXP SaaS網站將Connector部署到政府區域、因此下一個最佳選擇是從Azure Marketplace部署Connector。 
---
= 從Azure Marketplace建立連接器
:hardbreaks:
:allow-uri-read: 
:nofooter: 
:icons: font
:linkattrs: 
:imagesdir: ./media/


[role="lead"]
對於Azure商用區域而言、最好直接從BlueXP建立Connector、但您也可以從Azure Marketplace（如果您願意）啟動Connector。對於Azure政府區域而言、您無法從BlueXP SaaS網站將Connector部署到政府區域、因此下一個最佳選擇是從Azure Marketplace部署Connector。


TIP: 您也可以在網路或雲端的現有Linux主機上下載並安裝Connector軟體。 link:task-installing-linux.html["瞭解如何在現有的Linux主機上安裝Connector"]。



== 在 Azure 中建立 Connector

使用Azure Marketplace中的映像在Azure中部署Connector、然後登入Connector以指定您的NetApp帳戶。

.步驟
. 前往Azure Marketplace的NetApp Connector VM頁面。
+
** https://azuremarketplace.microsoft.com/en-us/marketplace/apps/netapp.netapp-oncommand-cloud-manager["適用於商業區域的Azure Marketplace頁面"^]
** https://portal.azure.us/#create/netapp.netapp-oncommand-cloud-manageroccm-byol["Azure政府區域的Azure Marketplace頁面"^]


. 按一下「 * 立即取得 * 」、然後按一下「 * 繼續 * 」。
. 從 Azure 入口網站按一下 * 「 Create 」（建立） * 、然後依照步驟設定虛擬機器。
+
設定 VM 時請注意下列事項：

+
** 連接器可搭配HDD或SSD磁碟以最佳方式執行。
** 選擇符合 CPU 和 RAM 需求的 VM 大小。我們建議使用 DS3 v2 。
+
link:task-installing-linux.html["檢閱 VM 需求"]。

** 對於網路安全性群組、 Connector 需要使用 SSH 、 HTTP 和 HTTPS 的傳入連線。
+
link:reference-ports-azure.html["深入瞭解 Connector 的安全性群組規則"]。

** 在「 * 管理 * 」下、選取「 * 開啟 * 」、為連接器啟用 * 系統指派的託管身分識別 * 。
+
此設定非常重要、因為託管身分識別可讓 Connector 虛擬機器在 Azure Active Directory 中識別自己、而無需提供任何認證。 https://docs.microsoft.com/en-us/azure/active-directory/managed-identities-azure-resources/overview["深入瞭解 Azure 資源的託管身分識別"^]。



. 在「 * 檢閱 + 建立 * 」頁面上、檢閱您的選擇、然後按一下「 * 建立 * 」開始部署。
+
Azure 以指定的設定部署虛擬機器。虛擬機器和 Connector 軟體應在大約五分鐘內執行。

. 從連線至 Connector 虛擬機器的主機開啟網頁瀏覽器、然後輸入下列 URL ：
+
https://_ipaddress_[]

. 登入後、設定 Connector ：
+
.. 指定要與Connector建立關聯的NetApp帳戶。
+
link:concept-netapp-accounts.html["瞭解NetApp客戶"]。

.. 輸入系統名稱。
+
image:screenshot_set_up_cloud_manager.gif["顯示「設定藍圖XP」畫面的快照、可讓您選取NetApp帳戶並命名系統。"]





.結果
現在已安裝Connector、並使用您的NetApp帳戶進行設定。

如果Connector位於Azure商業區域、請開啟網頁瀏覽器並前往 https://console.bluexp.netapp.com[] 開始使用Connector with BlueXP。

如果連接器位於Azure政府區域、您可以開啟網頁瀏覽器並連線至連接器執行個體的IP位址、以使用BlueXP： https://_ipaddress_[]

由於連接器部署在政府區域、因此無法從存取 https://console.bluexp.netapp.com[]。



== 授予 Azure 權限

當您在 Azure 中部署 Connector 時、您應該已啟用 https://docs.microsoft.com/en-us/azure/active-directory/managed-identities-azure-resources/overview["系統指派的託管身分識別"^]。您現在必須建立自訂角色、然後將角色指派給 Connector 虛擬機器以進行一或多項訂閱、以授予必要的 Azure 權限。

.步驟
. 建立自訂角色：
+
.. 複製的內容 link:reference-permissions-azure.html["Connector的自訂角色權限"] 並將它們儲存在Json檔案中。
.. 將 Azure 訂閱 ID 新增至可指派的範圍、以修改 Json 檔案。
+
您應該為使用者建立 Cloud Volumes ONTAP 的各個 Azure 訂閱新增 ID 。

+
* 範例 *

+
[source, json]
----
"AssignableScopes": [
"/subscriptions/d333af45-0d07-4154-943d-c25fbzzzzzzz",
"/subscriptions/54b91999-b3e6-4599-908e-416e0zzzzzzz",
"/subscriptions/398e471c-3b42-4ae7-9b59-ce5bbzzzzzzz"
----
.. 使用 Json 檔案在 Azure 中建立自訂角色。
+
下列步驟說明如何在Azure Cloud Shell中使用Bash建立角色。

+
*** 開始 https://docs.microsoft.com/en-us/azure/cloud-shell/overview["Azure Cloud Shell"^] 並選擇Bash環境。
*** 上傳Json檔案。
+
image:screenshot_azure_shell_upload.png["Azure Cloud Shell的快照、您可在其中選擇上傳檔案的選項。"]

*** 輸入下列Azure CLI命令：
+
[source, azurecli]
----
az role definition create --role-definition Policy_for_Setup_As_Service_Azure.json
----
+
現在您應該有一個名為BlueXP運算子的自訂角色、可以指派給連接器虛擬機器。





. 將角色指派給連接器虛擬機器以進行一或多項訂閱：
+
.. 開啟 * 「訂閱」 * 服務、然後選取您要在其中部署 Cloud Volumes ONTAP 的訂閱。
.. 按一下*存取控制（IAM）*>*新增*>*新增角色指派*。
.. 在「*角色*」索引標籤中、選取「*藍圖XP操作員*」角色、然後按一下「*下一步*」。
+

NOTE: BlueXP運算子是在BlueXP原則中提供的預設名稱。如果您為角色選擇不同的名稱、請改為選取該名稱。

.. 在「*成員*」索引標籤中、完成下列步驟：
+
*** 指派*託管身分識別*的存取權。
*** 按一下*選取成員*、選取建立連接器虛擬機器的訂閱、選擇*虛擬機器*、然後選取連接器虛擬機器。
*** 按一下*選取*。
*** 單擊 * 下一步 * 。


.. 按一下「*檢閱+指派*」。
.. 如果您想要從 Cloud Volumes ONTAP 其他訂閱中部署、請切換至該訂閱、然後重複這些步驟。




.結果
Connector 現在擁有管理公有雲環境中資源和程序所需的權限。在您建立新的工作環境時、BlueXP會自動使用此Connector。但如果您有多個連接器、就需要 link:task-managing-connectors.html["在兩者之間切換"]。

如果您在建立Connector的同一個Azure帳戶中擁有Azure Blob儲存設備、您會看到Azure Blob工作環境會自動出現在Canvas. link:task-viewing-azure-blob.html["深入瞭解如何運用此工作環境"]。



== 開啟連接埠3128以顯示AutoSupport 資訊

如果您計畫在Cloud Volumes ONTAP 無法連上傳出網際網路連線的子網路中部署「還原」系統、則BlueXP會自動將Cloud Volumes ONTAP 「還原」設定為使用「連接器」做為Proxy伺服器。

唯一的需求是確保連接器的安全性群組允許連接埠3128上的傳入連線。部署Connector之後、您需要開啟此連接埠。

如果您使用預設的資訊安全群組Cloud Volumes ONTAP 來執行此功能、則無需變更其安全群組。但是如果您打算定義嚴格Cloud Volumes ONTAP 的for the Sfor the Sfor the、那麼您也必須確保Cloud Volumes ONTAP 該安全性群組允許連接埠3128上的傳出連線。
